<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="/web/static/favicon.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <title>RPi Dashboard</title>
    <style>
        body {
            font-family: sans-serif;
            background: #111;
            color: #eee;
            padding: 20px;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            max-width: 1200px;
            margin: 0 auto;              /* centers the whole grid */
            justify-content: center;     /* centers cards inside */
        }
        .card-center {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 120px;
            background: #222;
            padding: 15px;
            border-radius: 8px;
            flex: 1 1 300px;
        }
        .card {
            background: #222;
            padding: 15px;
            border-radius: 8px;
            flex: 1 1 300px;
        }
        .button-62 {
            font-size: 18px;
            padding: 1em 3em;
            border: none;
            outline: none;
            color: rgb(255, 255, 255);
            background: #111;
            cursor: pointer;
            position: relative;
            z-index: 0;
            border-radius: 14px;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }
        .button-62:before {
            content: "";
            background: linear-gradient(
                45deg,
                #ff0000,
                #ff7300,
                #fffb00,
                #48ff00,
                #00ffd5,
                #002bff,
                #7a00ff,
                #ff00c8,
                #ff0000
            );
            position: absolute;
            top: -2px;
            left: -2px;
            background-size: 400%;
            z-index: -1;
            filter: blur(5px);
            -webkit-filter: blur(5px);
            width: calc(100% + 4px);
            height: calc(100% + 4px);
            animation: glowing-button-85 20s linear infinite;
            transition: opacity 0.3s ease-in-out;
            border-radius: 10px;
        }

        @keyframes glowing-button-85 {
            0% { background-position: 0 0; }
            50% { background-position: 400% 0; }
            100% { background-position: 0 0; }
        }

        .button-62:after {
            z-index: -1;
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            background: #222;
            left: 0;
            top: 0;
            border-radius: 10px;
        }

        h1 {
            font-size: 40px;
            font-family: Calibri, sans-serif;
            font-weight: bold;
            text-align: center;
            background: linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet);
            background-size: 400% 400%;
            color: #fff;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: rainbow 5s linear infinite;
        }

        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
    </style>
</head>

<body>
<h1>RPi Dashboard</h1>

<div class="container">
    <div class="card">
        <h2>System</h2>
        <p>CPU Usage: <span id="cpu">--</span> %</p>
        <p>RAM Usage: <span id="ram">--</span> %</p>
        <p>RAM speed: <span id="ram_speed">--</span> mhz</p>
        <p>temperature: <span id="core_temp">--</span> Â°C</p>
    </div>

    <div class="card-center">
        <button class="button-62" onclick="window.location.href='https://www.pinode.dev/site2';">
            Go to another website
        </button>
    </div>

    <div class="card">
        <h2>Network</h2>
        <p>RX: <span id="rx">--</span> kbps</p>
        <p>TX: <span id="tx">--</span> kbps</p>
    </div>

    <div class="card">
        <h2>Funny thingys</h2>
        <h4>Random Insult:</h4>
        <p><span id="insult">--</span></p>
        <h4>Random Quote:</h4>
        <p><span id="quote">--</span></p>
    </div>

    <div class="card">
        <h2>Weather in <span id="city">--</span></h2>
        <h4>Today (<span id="weather_current_date">--</span>)</h4>
        <p>
            Temperature: <span id="weather_temp">--</span> Â°C
            (H: <span id="current_high">--</span>Â° L: <span id="current_low">--</span>Â°)
        </p>
        <p>Condition: <span id="weather_condition">--</span></p>

        <h4>Forecast - Next 2 Days</h4>
        <p>
            <strong><span id="forecast_day1_date">Day 1</span>:</strong>
            <span id="forecast_day1_temp">--</span> Â°C
            (H: <span id="forecast_day1_high">--</span>Â° L: <span id="forecast_day1_low">--</span>Â°)
        </p>
        <p>
            <strong><span id="forecast_day2_date">Day 2</span>:</strong>
            <span id="forecast_day2_temp">--</span> Â°C
            (H: <span id="forecast_day2_high">--</span>Â° L: <span id="forecast_day2_low">--</span>Â°)
        </p>
    </div>

    <div class="card">
        <h2>External Sensors (in the pi's room)</h2>
        <p>humidity: <span id="humidity">--</span> %</p>
        <p>temperature: <span id="temp">--</span> Â°C</p>
    </div>

    <div class="card">
        <h2>backend status:</h2>
        <h4>system: <span id="system-status-indicator">ðŸ”´</span></h4>
        <h4>sensors: <span id="sensors-status-indicator">ðŸ”´</span></h4>
        <h4>network: <span id="network-status-indicator">ðŸ”´</span></h4>
        <h4>weather: <span id="weather-status-indicator">ðŸ”´</span></h4>
        <h4>fun: <span id="fun-status-indicator">ðŸ”´</span></h4>
    </div>
</div>

<script>
function setText(id, value) {
    const el = document.getElementById(id);
    if (!el) return;            // IMPORTANT: prevents dashboard from crashing
    el.textContent = value;
}

function getStatus(timestamp) {
    if (!timestamp) return "stale";
    const lastUpdate = new Date(timestamp);
    const now = new Date();
    const diffSeconds = (now - lastUpdate) / 1000;
    return diffSeconds < 15 ? "fresh" : "stale";
}

function getStatusColor(status) {
    return status === "fresh" ? "ðŸŸ¢" : "ðŸ”´";
}

async function update() {
    try {
        const sensors = await fetch("/api/sensors").then(r => r.json());
        const system  = await fetch("/api/system").then(r => r.json());
        const network = await fetch("/api/network").then(r => r.json());
        const fun     = await fetch("/api/fun").then(r => r.json());
        const weather = await fetch("/api/weather").then(r => r.json());

        const systemStatus  = system.timestamp  ? getStatus(system.timestamp)   : "stale";
        const networkStatus = network.timestamp ? getStatus(network.timestamp)  : "stale";
        const sensorsStatus = sensors.timestamp ? getStatus(sensors.timestamp)  : "stale";
        const funStatus     = fun.timestamp     ? getStatus(fun.timestamp)      : "stale";
        const weatherStatus = weather.timestamp ? getStatus(weather.timestamp)  : "stale";

        // System
        setText("cpu",       system.cpu ?? "--");
        setText("ram",       system.ram ?? "--");
        setText("ram_speed", system.ram_speed ?? "--");
        setText("core_temp", system.core_temp ?? "--");

        // Network
        setText("rx", network.rx_kbps ?? "--");
        setText("tx", network.tx_kbps ?? "--");

        // Fun
        setText("quote",    fun.quote ?? "--");
        setText("insult",   fun.insult ?? "--");
        setText("coinflip", fun.coinflip ?? "--"); // safe even if element removed

        // Weather
        setText("city",                 weather.city ?? "--");
        setText("weather_temp",         (weather.outside_temp ?? "--"));
        setText("weather_condition",    weather.condition ?? "--");
        setText("weather_current_date", weather.current_date ?? "--");

        setText("current_high", (weather.current_high_temp ?? "--"));
        setText("current_low",  (weather.current_low_temp ?? "--"));

        setText("forecast_day1_date", weather.forecast_day1_date ?? "Day 1");
        setText("forecast_day1_temp", (weather.forecast_day1_avg_temp ?? "--"));
        setText("forecast_day1_high", (weather.forecast_day1_high_temp ?? "--"));
        setText("forecast_day1_low",  (weather.forecast_day1_low_temp ?? "--"));

        setText("forecast_day2_date", weather.forecast_day2_date ?? "Day 2");
        setText("forecast_day2_temp", (weather.forecast_day2_avg_temp ?? "--"));
        setText("forecast_day2_high", (weather.forecast_day2_high_temp ?? "--"));
        setText("forecast_day2_low",  (weather.forecast_day2_low_temp ?? "--"));

        // Status indicators
        setText("system-status-indicator",  getStatusColor(systemStatus));
        setText("network-status-indicator", getStatusColor(networkStatus));
        setText("sensors-status-indicator", getStatusColor(sensorsStatus));
        setText("weather-status-indicator", getStatusColor(weatherStatus));
        setText("fun-status-indicator",     getStatusColor(funStatus));

        // Sensors
        setText("humidity", sensors.humidity ?? "--");
        setText("temp",     sensors.temp ?? "--");

    } catch (error) {
        console.error("Error fetching dashboard data:", error);
    }
}

setInterval(update, 1000);
update();
</script>

</body>
</html>
