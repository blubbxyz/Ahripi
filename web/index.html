<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="/web/static/favicon.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <title>RPi Dashboard</title>
    <style>
        body {
            font-family: sans-serif;
            background: #111;
            color: #eee;
            padding: 20px;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            max-width: 1200px;
            margin: 0 auto;              /* centers the whole grid */
            justify-content: center;     /* centers cards inside */
        }
        .card-center {
                display: flex;
                flex-direction: column;   /* ðŸ‘ˆ THIS */
                justify-content: center;
                align-items: center;
                min-height: 120px;

                background: #222;
                padding: 15px;
                border-radius: 8px;
                flex: 1 1 300px;
        }
        .card {
            background: #222;
            padding: 15px;
            border-radius: 8px;
            flex: 1 1 300px;
        }
        .button-62 {
            font-size: 18px;
            padding: 1em 3em;
            border: none;
            outline: none;
            color: rgb(255, 255, 255);
            background: #111;
            cursor: pointer;
            position: relative;
            z-index: 0;
            border-radius: 14px;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
            }
        .button-62:before {
            content: "";
            background: linear-gradient(
                45deg,
                #ff0000,
                #ff7300,
                #fffb00,
                #48ff00,
                #00ffd5,
                #002bff,
                #7a00ff,
                #ff00c8,
                #ff0000
            );
            position: absolute;
            top: -2px;
            left: -2px;
            background-size: 400%;
            z-index: -1;
            filter: blur(5px);
            -webkit-filter: blur(5px);
            width: calc(100% + 4px);
            height: calc(100% + 4px);
            animation: glowing-button-85 20s linear infinite;
            transition: opacity 0.3s ease-in-out;
            border-radius: 10px;
            }

            @keyframes glowing-button-85 {
            0% {
                background-position: 0 0;
            }
            50% {
                background-position: 400% 0;
            }
            100% {
                background-position: 0 0;
            }
            }

        .button-62:after {
            z-index: -1;
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            background: #222;
            left: 0;
            top: 0;
            border-radius: 10px;
            }
        h1 {
            font-size: 40px;
            font-family: Calibri, sans-serif;
            font-weight: bold;
            text-align: center;
            background: linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet);
            background-size: 400% 400%;
            color: #fff; /* Fallback for browsers that do not support background-clip: text */
            /* Note: background-clip: text is not supported in Firefox and some other browsers */
            background-clip: text;
            -webkit-background-clip: text;
            /* -webkit-text-fill-color is non-standard and works only in WebKit-based browsers */
            -webkit-text-fill-color: transparent;
            animation: rainbow 5s linear infinite;
            animation: rainbow 5s linear infinite;
        }

        @keyframes rainbow {
            0% {
                background-position: 0% 50%;
            }
            100% {
                background-position: 100% 50%;
            }
        }
    </style>
</head>
</head>
<body>

<h1>RPi Dashboard</h1>

<div class="container">
<div class="card">
    <h2>System</h2>
    <h4>status: <span id="system-status-indicator">ðŸ”´</span></h4>
    <p>CPU Usage: <span id="cpu">--</span> %</p>
    <p>RAM Usage: <span id="ram">--</span> %</p>
    <p>RAM speed: <span id="ram_speed">--</span> mhz</p>
    <p>temperature: <span id="core_temp">--</span> Â°C</p>
</div>

<div class="card-center">
        <button class="button-62" onclick="window.location.href='https://www.pinode.dev/site2';">
            Go to another website
        </button>


</div>

<div class="card">
  <h2>Network</h2>
  <h4>status: <span id="network-status-indicator">ðŸ”´</span></h4>
  <p>RX: <span id="rx">--</span> kbps</p>
  <p>TX: <span id="tx">--</span> kbps</p>
</div>

<div class="card">
    <h2>Funny thingys</h2>
    <h4>Random Insult:</h4>
    <p> <span id="insult">--</span> </p>
    <h4>Random Quote:</h4>
    <p> <span id="quote">--</span> </p>
</div>

<div class="card">
    <h2>Weather in <span id="city">--</span></h2>
    <h4>Today (<span id="weather_current_date">--</span>)</h4>
    <p>Temperature: <span id="weather_temp">--</span> Â°C (H: <span id="current_high">--</span>Â° L: <span id="current_low">--</span>Â°)</p>
    <p>Condition: <span id="weather_condition">--</span></p>
    
    <h4>Forecast - Next 2 Days</h4>
    <p><strong><span id="forecast_day1_date">Day 1</span>:</strong> <span id="forecast_day1_temp">--</span> Â°C (H: <span id="forecast_day1_high">--</span>Â° L: <span id="forecast_day1_low">--</span>Â°)</p>
    <p><strong><span id="forecast_day2_date">Day 2</span>:</strong> <span id="forecast_day2_temp">--</span> Â°C (H: <span id="forecast_day2_high">--</span>Â° L: <span id="forecast_day2_low">--</span>Â°)</p>
</div>

<div class="card">
    <h2>External Sensors (in the pi's room)</h2>
      <h4>status: <span id="sensors-status-indicator">ðŸ”´</span></h4>
    <p>humidity: <span id="humidity">--</span> %</p>
    <p>temperature: <span id="temp">--</span> Â°C</p>
</div>

<script>
async function update() {
    try {
        const sensors = await fetch("/api/sensors").then(r => r.json());
        const system  = await fetch("/api/system").then(r => r.json());
        const network = await fetch("/api/network").then(r => r.json());
        const fun     = await fetch("/api/fun").then(r => r.json());
        const weather = await fetch("/api/weather").then(r => r.json());
        
        const systemStatus = system.timestamp ? getStatus(system.timestamp) : "stale";
        const networkStatus = network.timestamp ? getStatus(network.timestamp) : "stale";
        const sensorsStatus = sensors.timestamp ? getStatus(sensors.timestamp) : "stale";

        document.getElementById("cpu").textContent = system.cpu || "--";
        document.getElementById("ram").textContent = system.ram || "--";
        document.getElementById("ram_speed").textContent = system.ram_speed || "--";
        document.getElementById("core_temp").textContent = system.core_temp || "--";
        document.getElementById("rx").textContent = network.rx_kbps || "--";
        document.getElementById("tx").textContent = network.tx_kbps || "--";
        document.getElementById("quote").textContent = fun.quote || "--";
        document.getElementById("insult").textContent = fun.insult || "--"; 
        
        document.getElementById("city").textContent = weather.city || "--";
        document.getElementById("weather_temp").textContent = (weather.outside_temp !== null && weather.outside_temp !== undefined) ? weather.outside_temp : "--";
        document.getElementById("weather_condition").textContent = weather.condition || "--";
        document.getElementById("weather_current_date").textContent = weather.current_date || "--";
        document.getElementById("current_high").textContent = (weather.current_high_temp !== null && weather.current_high_temp !== undefined) ? weather.current_high_temp : "--";
        document.getElementById("current_low").textContent = (weather.current_low_temp !== null && weather.current_low_temp !== undefined) ? weather.current_low_temp : "--";
        
        document.getElementById("forecast_day1_date").textContent = weather.forecast_day1_date || "Day 1";
        document.getElementById("forecast_day1_temp").textContent = (weather.forecast_day1_avg_temp !== null && weather.forecast_day1_avg_temp !== undefined) ? weather.forecast_day1_avg_temp : "--";
        document.getElementById("forecast_day1_high").textContent = (weather.forecast_day1_high_temp !== null && weather.forecast_day1_high_temp !== undefined) ? weather.forecast_day1_high_temp : "--";
        document.getElementById("forecast_day1_low").textContent = (weather.forecast_day1_low_temp !== null && weather.forecast_day1_low_temp !== undefined) ? weather.forecast_day1_low_temp : "--";
        
        document.getElementById("forecast_day2_date").textContent = weather.forecast_day2_date || "Day 2";
        document.getElementById("forecast_day2_temp").textContent = (weather.forecast_day2_avg_temp !== null && weather.forecast_day2_avg_temp !== undefined) ? weather.forecast_day2_avg_temp : "--";
        document.getElementById("forecast_day2_high").textContent = (weather.forecast_day2_high_temp !== null && weather.forecast_day2_high_temp !== undefined) ? weather.forecast_day2_high_temp : "--";
        document.getElementById("forecast_day2_low").textContent = (weather.forecast_day2_low_temp !== null && weather.forecast_day2_low_temp !== undefined) ? weather.forecast_day2_low_temp : "--";
        
        document.getElementById("system-status-indicator").textContent = getStatusColor(systemStatus);
        document.getElementById("network-status-indicator").textContent = getStatusColor(networkStatus);
        document.getElementById("sensors-status-indicator").textContent = getStatusColor(sensorsStatus);
        document.getElementById("humidity").textContent = sensors.humidity || "--";
        document.getElementById("temp").textContent = sensors.temp || "--";
    } catch (error) {
        console.error("Error fetching dashboard data:", error);
    }
}

function getStatus(timestamp) {
    if (!timestamp) {
        console.log("No timestamp received");
        return "stale";
    }
    const lastUpdate = new Date(timestamp);
    const now = new Date();
    const diffSeconds = (now - lastUpdate) / 1000;
    console.log("Timestamp:", timestamp, "Diff seconds:", diffSeconds);
    return diffSeconds < 15 ? "fresh" : "stale";  // 15 second threshold
}

function getStatusColor(status) {
    return status === "fresh" ? "ðŸŸ¢" : "ðŸ”´";
}

setInterval(update, 1000);
update();
</script>

</body>
</html>
